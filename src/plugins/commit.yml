name: command
description: "command plugin for gpt cli"
repository: "johannlai/gptcli"
author: "johannlai"
help: |
  command plugin is prompt to get the command with
  Natural Language Processing (NLP) and execute it.

  Usage:

    gpt command "find all txt files in current directory"

env:
  LOCALE: "en"
  style: "cz"
steps:
  - name: "get diff"
    script: |
      export diff_output=$(git diff HEAD)
      echo "::set-output name=diff::'$diff_output'"
    export:
      diff: diff
  - name: if style is cz then set prompt to cz
    if: |
      "$style" == "cz"
    script: |
      echo "::set-output name=otherPrompt::'make it into commitizen style , e.g: feat: add new feature, fix: fix bug, refactor: refactor code, docs: add document, style: change code style, test: add test, chore: change build process or tool"
    export:
      otherPrompt: otherPrompt
  # - name: if style is cz then set prompt to gitmoji
  #   if: |
  #     "$style" == "gitmoji"
  #   script: |
  #     echo "::set-output name=otherPrompt::'make it into gitmoji style like :pencil2: xxx'"
  #   export:
  #     otherPrompt: otherPrompt
  - name: "ask ai to output command"
    uses: "gpt:createChatCompletion"
    with:
      messages:
        - role: "user"
          content: "Write an insightful but concise Git commit message in a complete sentence in present tense for the following diff without prefacing it with anything with style of $otherPrompt, not more than 100 characters, the response must be in the language ${LOCALE}:\n${diff} \n "
    export:
      response_content: COMMAND
  - name: "ask if user want to execute the command"
    uses: "gpt:confirm"
    with:
      message: "Would you like to use this commit message ⬆️ ? "
      default: true
    export:
      answer: ANSWER
  - name: "execute the command"
    if: $ANSWER == true
    script: |
      echo "git commit -m"$COMMAND""
      git commit -m"$COMMAND"
