name: command
description: "command plugin for gpt cli"
repository: "johannlai/gptcli"
author: "johannlai"
help: |
  command plugin is prompt to get the command with
  Natural Language Processing (NLP) and execute it.

  Usage:

    gpt command "find all txt files in current directory"

env:
  OPENAI_API_KEY: $OPENAI_API_KEY
  LOCALE: $LOCALE
steps:
  - name: "get diff"
    script: |
      diff_output=$(git diff HEAD)
      echo "::set-output name=diff::$diff_output"
    export:
      diff: diff
  - name: "ask ai to output command"
    uses: "gpt:createChatCompletion"
    with:
      messages:
        - role: "user"
          content: "Write an insightful but concise Git commit message in a complete sentence in present tense for the following diff without prefacing it with anything, the response must be in the language ${LOCALE}:\n${diff}"
    export:
      response_content: COMMAND
  - name: "ask if user want to execute the command"
    uses: "gpt:confirm"
    with:
      message: "execute the command above ⬆️ ? "
      default: true
    export:
      answer: ANSWER
  - name: "execute the command"
    if: $ANSWER == true
    script: |
      $COMMAND
